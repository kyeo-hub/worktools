# PyQt工作工具开发文档

## 项目概述

本项目是一个基于PyQt的模块化工作工具，采用插件式架构，支持功能的动态扩展。左侧为功能导航区，右侧为功能工作区，界面简洁清晰。

## 系统架构

### 主要组件

1. **主窗口 (MainWindow)**
   - 负责整体布局管理
   - 处理功能模块间的切换
   - 管理菜单和状态栏

2. **功能管理器 (PluginManager)**
   - 负责加载和管理所有功能模块
   - 提供统一的接口用于功能注册和获取
   - 支持动态添加新功能

3. **导航面板 (NavigationPanel)**
   - 显示所有已加载的功能模块
   - 提供功能切换界面
   - 支持功能分类和搜索

4. **功能工作区 (Workspace)**
   - 显示当前选中的功能界面
   - 为每个功能提供独立的显示区域
   - 管理功能间的切换动画

5. **功能基类 (BasePlugin)**
   - 所有功能模块的基础类
   - 定义标准接口方法
   - 提供通用功能支持

## 目录结构

```
d:/work-tools/
├── main.py                     # 应用程序入口
├── README.md                   # 项目文档
├── requirements.txt            # 依赖包列表
└── worktools/                 # 主应用包
    ├── __init__.py
    ├── app.py                 # 主应用类
    ├── main_window.py         # 主窗口实现
    ├── navigation.py          # 导航面板
    ├── workspace.py           # 工作区管理
    ├── plugin_manager.py      # 插件管理器
    ├── base_plugin.py         # 插件基类
    ├── resources/             # 资源文件
    │   └── icons/             # 图标资源
    └── plugins/               # 功能插件目录
        ├── __init__.py
        ├── plugin1.py         # 功能插件1占位
        ├── plugin2.py         # 功能插件2占位
        └── plugin3.py         # 功能插件3占位
```

## 功能接口规范

### 插件基类 (BasePlugin)

```python
class BasePlugin(QWidget):
    """所有功能插件的基础类"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
    
    def get_name(self) -> str:
        """返回插件显示名称"""
        raise NotImplementedError
    
    def get_description(self) -> str:
        """返回插件描述信息"""
        raise NotImplementedError
    
    def get_icon(self) -> QIcon:
        """返回插件图标"""
        raise NotImplementedError
    
    def initialize(self):
        """插件初始化，加载资源等"""
        pass
    
    def on_activate(self):
        """当插件被激活时调用"""
        pass
    
    def on_deactivate(self):
        """当插件被停用时调用"""
        pass
    
    def save_state(self) -> dict:
        """保存插件状态"""
        return {}
    
    def restore_state(self, state: dict):
        """恢复插件状态"""
        pass
    
    def get_settings_widget(self) -> QWidget:
        """返回插件设置界面（可选）"""
        return None
```

## 预设功能模块

### 1. 文本处理工具 (TextProcessor)
- **功能描述**: 提供常用文本处理功能
- **主要特性**: 文本格式化、编码转换、正则表达式匹配等
- **扩展接口**: 可添加自定义文本处理函数

### 2. 文件管理器 (FileManager)
- **功能描述**: 增强的文件管理和操作工具
- **主要特性**: 文件批量重命名、搜索、属性查看等
- **扩展接口**: 可添加自定义文件操作

### 3. 系统工具 (SystemTools)
- **功能描述**: 常用系统工具集合
- **主要特性**: 进程管理、系统信息查看等
- **扩展接口**: 可添加自定义系统工具

### 4. 月汇总工具 (MonthlySummary)
- **功能描述**: 运输数据汇总和分析工具
- **主要特性**: 
  - 自动识别车牌号并判断运输方式（汽提/装船）
  - 根据产地自动分类运输类别（水运/铁运/汽运）
  - 生成汇总统计表并导出Excel
  - 支持自定义车牌号修正和产地类别映射
- **使用说明**: 
  1. 选择Excel数据文件，需包含"提货车号"、"产地"、"实发量"、"实发件数"等列
  2. 配置车牌号修正规则，处理常见输入错误（如"卾"修正为"鄂"）
  3. 配置产地到运输类别的映射关系
  4. 点击"处理数据"自动分析并生成汇总表
  5. 可保存结果到新的Excel文件，包含原始数据和汇总表

### 5. Excel合并工具 (ExcelMerger)
- **功能描述**: 用于处理具有多层级结构的Excel表格合并
- **主要特性**: 
  - 双模式支持：多文件合并和单文件多工作表合并
  - 支持跳过顶部标题行（如报告标题、副标题等）
  - 支持自定义列标题行位置
  - 支持跳过底部合计行（各种"合计"、"总计"等）
  - 支持批量添加文件或整个文件夹
  - 支持单个文件的多工作表预览
  - 可选择性添加文件来源列或工作表来源列
  - 提供数据预览功能
- **使用说明**: 
  - **多文件合并模式**：
    1. 选择"多文件合并"模式
    2. 点击"添加文件"或"添加文件夹"选择要合并的Excel文件
    3. 点击"合并设置"配置跳过行数、标题行位置等参数
    4. 点击"执行合并"开始处理多个Excel表格
  - **单文件多工作表合并模式**：
    1. 选择"单文件多工作表合并"模式
    2. 点击"浏览"选择包含多个工作表的Excel文件
    3. 查看工作表预览列表
    4. 点击"合并设置"配置处理参数
    5. 点击"执行合并"开始处理同一文件中的多个工作表
  6. 在"数据预览"选项卡查看合并结果
  7. 点击"保存结果"将合并后的数据导出为新的Excel文件

### 6. Excel去重工具 (ExcelDeduplication)
- **功能描述**: 用于Excel表格数据的去重处理
- **主要特性**: 
  - 支持全行匹配去重或指定列去重
  - 可选择保留首条记录或最后一条记录
  - 支持多列组合去重
  - 可选忽略大小写和空格
  - 提供去重前后数据对比
  - 显示详细的去重统计信息
- **使用说明**: 
  1. 选择要处理的Excel文件
  2. 点击"去重设置"配置去重参数
     - 全行匹配：基于整行数据进行去重
     - 指定列：基于选定的列进行去重
  3. 点击"执行去重"开始处理数据
  4. 在"数据对比"选项卡查看去重前后的数据
  5. 查看去重统计信息（删除行数、删除比例等）
  6. 点击"保存结果"将去重后的数据导出为新的Excel文件

## 开发指南

### 添加新功能模块

1. 在 `worktools/plugins` 目录下创建新的插件文件
2. 继承 `BasePlugin` 类并实现必要的方法
3. 在 `worktools/plugins/__init__.py` 中注册新插件
4. 运行应用程序，新功能将自动加载

### 插件开发最佳实践

1. 保持插件间的独立性，避免直接相互调用
2. 使用信号和槽机制进行跨插件通信
3. 提供完整的插件信息和配置选项
4. 实现状态保存和恢复机制
5. 设计用户友好的界面布局

## 界面设计规范

### 布局原则

1. 左侧导航面板宽度为应用程序宽度的 20-30%
2. 功能区采用网格布局，支持响应式调整
3. 保持一致的配色方案和字体
4. 提供适当的状态反馈和提示信息

### 主题支持

应用程序支持明暗主题切换，可通过菜单进行配置。新增插件应遵循主题设计规范，确保在不同主题下的显示效果。

## 部署说明

### 开发环境

1. 安装依赖: `pip install -r requirements.txt`
2. 运行应用: `python main.py`

### 打包发布

可使用 PyInstaller 打包为可执行文件:

```
pyinstaller --windowed --icon=resources/icons/app.ico main.py
```

## 版本历史

- v0.1.0: 初始版本，建立基础架构和三个功能占位模块
- 后续版本将根据功能添加进行更新

## 联系方式

如有问题或建议，请通过项目仓库提交issue。